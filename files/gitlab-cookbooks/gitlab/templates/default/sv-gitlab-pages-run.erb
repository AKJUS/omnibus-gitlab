#!/bin/bash
set -e # fail on errors

# Redirect stderr -> stdout
exec 2>&1

cd <%= node['gitlab']['gitlab-pages']['dir'] %>

exec /opt/gitlab/embedded/bin/gitlab-pages \
    -listen-https "<%= node['gitlab']['gitlab-pages']['external_https'] %>" \
    -listen-http  "<%= node['gitlab']['gitlab-pages']['external_http'] %>" \
    -listen-proxy "<%= node['gitlab']['gitlab-pages']['listen_proxy'] %>" \
    \
    -root-cert "<%= node['gitlab']['gitlab-pages']['cert'] %>" \
    -root-key  "<%= node['gitlab']['gitlab-pages']['cert_key'] %>" \
    \
    -pages-user "<%= node['gitlab']['web-server']['username'] %>" \
    -pages-domain "<%= node['gitlab']['gitlab-pages']['domain'] %>" \
    -pages-root "<%= node['gitlab']['gitlab-pages']['pages_root'] %>" \
    \
    -redirect_http <%= node['gitlab']['gitlab-pages']['redirect_http'] %> \
    -use-http2 <%= node['gitlab']['gitlab-pages']['use_http2'] %> \
