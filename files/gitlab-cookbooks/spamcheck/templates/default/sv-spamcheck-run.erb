#!/bin/bash

# Let runit capture all script error messages
exec 2>&1

cd <%= @options[:log_directory] %>

exec chpst -e <%= @options[:env_dir] %> -P \
  -u <%= @options[:user] %>:<%= @options[:groupname] %> \
  -U <%= @options[:user] %>:<%= @options[:groupname] %> \
  /opt/gitlab/embedded/bin/python3 <%= @options[:preprocessor_path] %>&

exec chpst -e <%= @options[:env_directory] %> -P \
  -u <%= @options[:user] %>:<%= @options[:groupname] %> \
  -U <%= @options[:user] %>:<%= @options[:groupname] %> \
  /opt/gitlab/embedded/bin/spamcheck -config <%= @options[:config_file] %>
